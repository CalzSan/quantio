<html><head><base href="https://enhanced-survival-shooter-v3.example.com/">
<meta charset="UTF-8">
<title>Quantio by Calzsan: Jogo de Sobrevivência</title>
<style>
  body, html {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    background-color: #111;
    font-family: Arial, sans-serif;
    color: #fff;
  }
  #gameCanvas {
    width: 100%;
    height: 100%;
    display: none;
  }
  #healthBar {
    position: absolute;
    top: 10px;
    left: 10px;
    width: 200px;
    height: 20px;
    background-color: #333;
    border: 2px solid #fff;
    display: none;
  }
  #healthFill {
    width: 100%;
    height: 100%;
    background-color: #0f0;
    transition: width 0.3s;
  }
  #lobby {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background-color: #222;
  }
  .menu-item {
    font-size: 24px;
    margin: 10px;
    padding: 10px 20px;
    background-color: #444;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  .menu-item:hover {
    background-color: #666;
  }
  #trophyCount, #leagueInfo {
    font-size: 20px;
    margin-bottom: 20px;
  }
  #timerDisplay {
    position: absolute;
    top: 10px;
    right: 10px;
    font-size: 24px;
    display: none;
  }
  #gameOverScreen {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 10;
  }
  #gameOverMessage {
    font-size: 48px;
    margin-bottom: 20px;
  }
  #trophyChange {
    font-size: 24px;
    margin-bottom: 20px;
  }
  #returnToLobby {
    font-size: 24px;
    padding: 10px 20px;
    background-color: #444;
    border-radius: 5px;
    cursor: pointer;
  }
  #leaguesScreen {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 10;
  }
  #leaguesList {
    list-style-type: none;
    padding: 0;
    margin: 20px 0;
  }
  #leaguesList li {
    font-size: 18px;
    margin: 10px 0;
  }
</style>
</head>
<body>
<div id="lobby">
  <div id="trophyCount">Troféus: 0</div>
  <div id="leagueInfo">Liga: Bronze</div>
  <div class="menu-item" id="startGame">Iniciar Jogo</div>
  <div class="menu-item" id="showEvents">Eventos</div>
  <div class="menu-item" id="showShop">Loja</div>
  <div class="menu-item" id="showLeagues">Ligas</div>
</div>
<div id="leaguesScreen" style="display: none;">
  <h2>Ligas e Troféus</h2>
  <ul id="leaguesList"></ul>
  <div class="menu-item" id="returnFromLeagues">Voltar ao Lobby</div>
</div>
<canvas id="gameCanvas"></canvas>
<div id="healthBar"><div id="healthFill"></div></div>
<div id="timerDisplay"></div>
<div id="gameOverScreen">
  <div id="gameOverMessage"></div>
  <div id="trophyChange"></div>
  <div id="returnToLobby">Voltar ao Lobby</div>
</div>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const healthFill = document.getElementById('healthFill');
const lobby = document.getElementById('lobby');
const gameOverScreen = document.getElementById('gameOverScreen');
const gameOverMessage = document.getElementById('gameOverMessage');
const trophyChangeElement = document.getElementById('trophyChange');
const returnToLobbyButton = document.getElementById('returnToLobby');
const trophyCountElement = document.getElementById('trophyCount');
const leagueInfoElement = document.getElementById('leagueInfo');
const timerDisplay = document.getElementById('timerDisplay');

let trophyCount = 0;
let gameStartTime;
let gameInProgress = false;
let gameTimer;

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const player = {
  x: canvas.width / 2,
  y: canvas.height / 2,
  radius: 20,
  speed: 5,
  color: '#00ff00',
  dx: 0,
  dy: 0,
  health: 100,
  isStuck: false,
  stuckTime: 0
};

const bullets = [];
const enemyBullets = [];
const enemies = [];
let mouseX = 0;
let mouseY = 0;
let spawnInterval;

const monsterTypes = ['normal', 'zombie', 'fast', 'squad'];

function spawnEnemy() {
  const side = Math.floor(Math.random() * 4);
  let x, y;

  switch(side) {
    case 0: x = Math.random() * canvas.width; y = -30; break;
    case 1: x = canvas.width + 30; y = Math.random() * canvas.height; break;
    case 2: x = Math.random() * canvas.width; y = canvas.height + 30; break;
    case 3: x = -30; y = Math.random() * canvas.height; break;
  }

  const type = monsterTypes[Math.floor(Math.random() * monsterTypes.length)];
  let enemy = {
    x: x,
    y: y,
    radius: 15,
    speed: 2,
    color: '#ff0000',
    angle: Math.random() * Math.PI * 2,
    detectionRadius: 200,
    evadeSpeed: 3,
    lastShot: 0,
    wanderAngle: Math.random() * Math.PI * 2,
    type: type
  };

  switch(type) {
    case 'zombie':
      enemy.color = '#00ff00';
      enemy.speed = 1.5;
      break;
    case 'fast':
      enemy.color = '#ffff00';
      enemy.speed = 4;
      enemy.radius = 10;
      break;
    case 'squad':
      enemy.color = '#ff00ff';
      enemy.members = [
        {shots: 1},
        {shots: 2},
        {shots: 3},
        {shots: 4}
      ];
      break;
  }

  enemies.push(enemy);
}

function drawPlayer() {
  ctx.save();
  ctx.translate(player.x, player.y);
  ctx.rotate(Math.atan2(mouseY - player.y, mouseX - player.x));

  // Player body
  ctx.beginPath();
  ctx.arc(0, 0, player.radius, 0, Math.PI * 2);
  ctx.fillStyle = player.isStuck ? '#808080' : '#4a90e2';
  ctx.fill();

  // Player armor
  ctx.beginPath();
  ctx.arc(0, 0, player.radius * 0.8, 0, Math.PI * 2);
  ctx.strokeStyle = '#2c3e50';
  ctx.lineWidth = 3;
  ctx.stroke();

  // Player eyes
  ctx.fillStyle = '#ffffff';
  ctx.beginPath();
  ctx.arc(player.radius * 0.3, -player.radius * 0.2, player.radius * 0.2, 0, Math.PI * 2);
  ctx.arc(player.radius * 0.3, player.radius * 0.2, player.radius * 0.2, 0, Math.PI * 2);
  ctx.fill();

  // Player weapon
  ctx.fillStyle = '#333333';
  ctx.fillRect(player.radius * 0.5, -player.radius * 0.1, player.radius * 0.8, player.radius * 0.2);

  ctx.restore();
}

function drawEnemies() {
  enemies.forEach(enemy => {
    ctx.save();
    ctx.translate(enemy.x, enemy.y);
    ctx.rotate(enemy.angle);

    switch(enemy.type) {
      case 'normal':
        drawNormalEnemy(enemy);
        break;
      case 'zombie':
        drawZombieEnemy(enemy);
        break;
      case 'fast':
        drawFastEnemy(enemy);
        break;
      case 'squad':
        drawSquadEnemy(enemy);
        break;
    }

    ctx.restore();
  });
}

function drawNormalEnemy(enemy) {
  ctx.fillStyle = '#ff4136';
  ctx.beginPath();
  ctx.arc(0, 0, enemy.radius, 0, Math.PI * 2);
  ctx.fill();

  // Enemy eyes
  ctx.fillStyle = '#ffffff';
  ctx.beginPath();
  ctx.arc(enemy.radius * 0.3, -enemy.radius * 0.2, enemy.radius * 0.2, 0, Math.PI * 2);
  ctx.arc(enemy.radius * 0.3, enemy.radius * 0.2, enemy.radius * 0.2, 0, Math.PI * 2);
  ctx.fill();

  // Enemy markings
  ctx.strokeStyle = '#990000';
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.moveTo(-enemy.radius * 0.5, -enemy.radius * 0.5);
  ctx.lineTo(enemy.radius * 0.5, enemy.radius * 0.5);
  ctx.moveTo(enemy.radius * 0.5, -enemy.radius * 0.5);
  ctx.lineTo(-enemy.radius * 0.5, enemy.radius * 0.5);
  ctx.stroke();
}

function drawZombieEnemy(enemy) {
  ctx.fillStyle = '#2ecc40';
  ctx.beginPath();
  ctx.arc(0, 0, enemy.radius, 0, Math.PI * 2);
  ctx.fill();

  // Zombie eyes
  ctx.fillStyle = '#ff4136';
  ctx.beginPath();
  ctx.arc(enemy.radius * 0.3, -enemy.radius * 0.2, enemy.radius * 0.2, 0, Math.PI * 2);
  ctx.arc(enemy.radius * 0.3, enemy.radius * 0.2, enemy.radius * 0.2, 0, Math.PI * 2);
  ctx.fill();

  // Zombie mouth
  ctx.strokeStyle = '#1a8829';
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.arc(0, enemy.radius * 0.3, enemy.radius * 0.4, 0, Math.PI);
  ctx.stroke();
}

function drawFastEnemy(enemy) {
  ctx.fillStyle = '#ffdc00';
  ctx.beginPath();
  ctx.moveTo(enemy.radius, 0);
  ctx.lineTo(-enemy.radius, -enemy.radius);
  ctx.lineTo(-enemy.radius, enemy.radius);
  ctx.closePath();
  ctx.fill();

  // Fast enemy eye
  ctx.fillStyle = '#ffffff';
  ctx.beginPath();
  ctx.arc(enemy.radius * 0.2, 0, enemy.radius * 0.2, 0, Math.PI * 2);
  ctx.fill();

  // Speed lines
  ctx.strokeStyle = '#ff851b';
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.moveTo(-enemy.radius * 1.2, 0);
  ctx.lineTo(-enemy.radius * 1.6, 0);
  ctx.moveTo(-enemy.radius * 1.3, -enemy.radius * 0.3);
  ctx.lineTo(-enemy.radius * 1.7, -enemy.radius * 0.4);
  ctx.moveTo(-enemy.radius * 1.3, enemy.radius * 0.3);
  ctx.lineTo(-enemy.radius * 1.7, enemy.radius * 0.4);
  ctx.stroke();
}

function drawSquadEnemy(enemy) {
  ctx.fillStyle = '#b10dc9';
  ctx.beginPath();
  ctx.arc(0, 0, enemy.radius, 0, Math.PI * 2);
  ctx.fill();

  // Squad member positions
  const positions = [
    {x: -enemy.radius * 0.6, y: -enemy.radius * 0.6},
    {x: enemy.radius * 0.6, y: -enemy.radius * 0.6},
    {x: -enemy.radius * 0.6, y: enemy.radius * 0.6},
    {x: enemy.radius * 0.6, y: enemy.radius * 0.6}
  ];

  // Draw squad members
  ctx.fillStyle = '#ffffff';
  positions.forEach((pos, index) => {
    ctx.beginPath();
    ctx.arc(pos.x, pos.y, enemy.radius * 0.3, 0, Math.PI * 2);
    ctx.fill();
    
    // Draw number of shots
    ctx.fillStyle = '#000000';
    ctx.font = `${enemy.radius * 0.3}px Arial`;
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(index + 1, pos.x, pos.y);
  });

  // Squad connection lines
  ctx.strokeStyle = '#7b0c8e';
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.moveTo(-enemy.radius * 0.6, -enemy.radius * 0.6);
  ctx.lineTo(enemy.radius * 0.6, enemy.radius * 0.6);
  ctx.moveTo(enemy.radius * 0.6, -enemy.radius * 0.6);
  ctx.lineTo(-enemy.radius * 0.6, enemy.radius * 0.6);
  ctx.stroke();
}

function drawBullets() {
  bullets.forEach(bullet => {
    ctx.beginPath();
    ctx.arc(bullet.x, bullet.y, 5, 0, Math.PI * 2);
    ctx.fillStyle = '#ffff00';
    ctx.fill();
    ctx.closePath();
  });

  enemyBullets.forEach(bullet => {
    ctx.beginPath();
    ctx.arc(bullet.x, bullet.y, 3, 0, Math.PI * 2);
    ctx.fillStyle = bullet.color || '#ff8800';
    ctx.fill();
    ctx.closePath();
  });
}

function drawCrosshair() {
  ctx.beginPath();
  ctx.arc(mouseX, mouseY, 10, 0, Math.PI * 2);
  ctx.strokeStyle = '#ff0000';
  ctx.lineWidth = 2;
  ctx.stroke();
  ctx.closePath();

  ctx.beginPath();
  ctx.moveTo(mouseX - 15, mouseY);
  ctx.lineTo(mouseX + 15, mouseY);
  ctx.moveTo(mouseX, mouseY - 15);
  ctx.lineTo(mouseX, mouseY + 15);
  ctx.strokeStyle = '#ff0000';
  ctx.lineWidth = 2;
  ctx.stroke();
  ctx.closePath();
}

function movePlayer() {
  if (!player.isStuck) {
    player.x += player.dx;
    player.y += player.dy;
    player.x = Math.max(player.radius, Math.min(canvas.width - player.radius, player.x));
    player.y = Math.max(player.radius, Math.min(canvas.height - player.radius, player.y));
  } else {
    player.stuckTime--;
    if (player.stuckTime <= 0) {
      player.isStuck = false;
    }
  }
}

function moveEnemies() {
  enemies.forEach(enemy => {
    let dx = player.x - enemy.x;
    let dy = player.y - enemy.y;
    let distance = Math.sqrt(dx * dx + dy * dy);

    let moveX, moveY;

    if (enemy.type === 'fast' && distance < 200) {
      moveX = dx / distance;
      moveY = dy / distance;
    } else {
      moveX = -dx / distance;
      moveY = -dy / distance;

      enemy.wanderAngle += (Math.random() - 0.5) * 0.5;
      let wanderX = Math.cos(enemy.wanderAngle);
      let wanderY = Math.sin(enemy.wanderAngle);

      moveX = (moveX + wanderX) / 2;
      moveY = (moveY + wanderY) / 2;
    }

    enemy.x += moveX * enemy.speed;
    enemy.y += moveY * enemy.speed;

    enemy.angle = Math.atan2(moveY, moveX);

    enemy.x = Math.max(enemy.radius, Math.min(canvas.width - enemy.radius, enemy.x));
    enemy.y = Math.max(enemy.radius, Math.min(canvas.height - enemy.radius, enemy.y));

    if (Date.now() - enemy.lastShot > 1000) {
      const angle = Math.atan2(player.y - enemy.y, player.x - enemy.x);
      const speed = 3;

      if (enemy.type === 'normal' || enemy.type === 'zombie') {
        enemyBullets.push({
          x: enemy.x,
          y: enemy.y,
          dx: Math.cos(angle) * speed,
          dy: Math.sin(angle) * speed,
          radius: 3,
          color: enemy.type === 'zombie' ? '#00ff00' : '#ff8800'
        });
      } else if (enemy.type === 'squad') {
        enemy.members.forEach(member => {
          for (let i = 0; i < member.shots; i++) {
            const spreadAngle = angle + (Math.random() - 0.5) * 0.5;
            enemyBullets.push({
              x: enemy.x,
              y: enemy.y,
              dx: Math.cos(spreadAngle) * speed,
              dy: Math.sin(spreadAngle) * speed,
              radius: 3,
              color: '#ff00ff'
            });
          }
        });
      }

      enemy.lastShot = Date.now();
    }

    if (enemy.type === 'fast' && distance < enemy.radius + player.radius) {
      player.health -= 2;
      updateHealthBar();
      if (player.health <= 0) {
        gameOver(false);
      }
    }
  });
}

function moveBullets() {
  bullets.forEach((bullet, index) => {
    bullet.x += bullet.dx;
    bullet.y += bullet.dy;
    if (bullet.x < 0 || bullet.x > canvas.width || bullet.y < 0 || bullet.y > canvas.height) {
      bullets.splice(index, 1);
    }
  });

  enemyBullets.forEach((bullet, index) => {
    bullet.x += bullet.dx;
    bullet.y += bullet.dy;
    if (bullet.x < 0 || bullet.x > canvas.width || bullet.y < 0 || bullet.y > canvas.height) {
      enemyBullets.splice(index, 1);
    }
  });
}

function checkCollisions() {
  bullets.forEach((bullet, bIndex) => {
    enemies.forEach((enemy, eIndex) => {
      const dx = bullet.x - enemy.x;
      const dy = bullet.y - enemy.y;
      const distance = Math.sqrt(dx * dx + dy * dy);

      if (distance < bullet.radius + enemy.radius) {
        bullets.splice(bIndex, 1);
        enemies.splice(eIndex, 1);
      }
    });
  });

  enemyBullets.forEach((bullet, bIndex) => {
    const dx = bullet.x - player.x;
    const dy = bullet.y - player.y;
    const distance = Math.sqrt(dx * dx + dy * dy);

    if (distance < bullet.radius + player.radius) {
      enemyBullets.splice(bIndex, 1);
      if (bullet.color === '#00ff00') {
        player.isStuck = true;
        player.stuckTime = 5 * 60;
      } else {
        player.health -= 10;
        updateHealthBar();
        if (player.health <= 0) {
          gameOver(false);
        }
      }
    }
  });
}

function updateHealthBar() {
  healthFill.style.width = `${player.health}%`;
}

function gameOver(won) {
  saveGameState();
  gameInProgress = false;
  clearInterval(spawnInterval);
  timerDisplay.style.display = 'none';
  const gameTime = (Date.now() - gameStartTime) / 1000;
  
  let trophyChange;
  if (won) {
    trophyChange = Math.floor(Math.random() * 6) + 28;
    gameOverMessage.textContent = `Vitória! Você sobreviveu por ${gameTime.toFixed(1)} segundos!`;
  } else {
    trophyChange = -(Math.floor(Math.random() * 4) + 24);
    gameOverMessage.textContent = `Derrota! Você sobreviveu por ${gameTime.toFixed(1)} segundos.`;
  }

  trophyCount += trophyChange;
  trophyCount = Math.max(0, trophyCount);
  trophyChangeElement.textContent = `Troféus ${trophyChange > 0 ? '+' : ''}${trophyChange}`;
  updateTrophyCount();
  updateLeague();

  canvas.style.display = 'none';
  document.getElementById('healthBar').style.display = 'none';
  gameOverScreen.style.display = 'flex';
}

function resetGame() {
  player.health = 100;
  player.isStuck = false;
  player.stuckTime = 0;
  updateHealthBar();
  enemies.length = 0;
  bullets.length = 0;
  enemyBullets.length = 0;
  player.x = canvas.width / 2;
  player.y = canvas.height / 2;
}

function startSpawning() {
  spawnInterval = setInterval(spawnEnemy, 2000);
}

function gameLoop() {
  if (!gameInProgress) return;

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  movePlayer();
  moveEnemies();
  moveBullets();
  checkCollisions();

  drawPlayer();
  drawEnemies();
  drawBullets();
  drawCrosshair();

  requestAnimationFrame(gameLoop);
}

function updateTimer() {
  timerDisplay.textContent = `Tempo: ${gameTimer}s`;
  if (gameTimer > 0) {
    gameTimer--;
    setTimeout(updateTimer, 1000);
  } else {
    gameOver(true);
  }
}

function startGame() {
  timerDisplay.style.display = 'block';
  gameTimer = 60;
  updateTimer();
}

const leaguesScreen = document.getElementById('leaguesScreen');
const leaguesList = document.getElementById('leaguesList');
const showLeaguesButton = document.getElementById('showLeagues');
const returnFromLeaguesButton = document.getElementById('returnFromLeagues');

const leaguesInfo = [
  { name: 'Sem Liga', trophies: 0 },
  { name: 'Liga Paia', trophies: 400 },
  { name: 'Rebelde', trophies: 900 },
  { name: 'Candidato', trophies: 1200 },
  { name: 'Patrão', trophies: 1700 },
  { name: 'Soberana', trophies: 2000 },
  { name: 'Estrelar', trophies: 2600 },
  { name: 'Liga Maior Campeão', trophies: 3000 },
  { name: 'Celeste', trophies: 3300 }
];

function showLeaguesScreen() {
  leaguesList.innerHTML = '';
  leaguesInfo.forEach(league => {
    const li = document.createElement('li');
    li.textContent = `${league.name}: ${league.trophies} troféus`;
    leaguesList.appendChild(li);
  });
  lobby.style.display = 'none';
  leaguesScreen.style.display = 'flex';
}

showLeaguesButton.addEventListener('click', showLeaguesScreen);

returnFromLeaguesButton.addEventListener('click', () => {
  leaguesScreen.style.display = 'none';
  lobby.style.display = 'flex';
});

document.addEventListener('keydown', (e) => {
  if (!player.isStuck) {
    switch(e.key) {
      case 'w': player.dy = -player.speed; break;
      case 's': player.dy = player.speed; break;
      case 'a': player.dx = -player.speed; break;
      case 'd': player.dx = player.speed; break;
    }
  }
});

document.addEventListener('keyup', (e) => {
  switch(e.key) {
    case 'w':
    case 's': player.dy = 0; break;
    case 'a':
    case 'd': player.dx = 0; break;
  }
});

canvas.addEventListener('mousemove', (e) => {
  mouseX = e.clientX;
  mouseY = e.clientY;
});

canvas.addEventListener('mousedown', (e) => {
  const angle = Math.atan2(e.clientY - player.y, e.clientX - player.x);
  const speed = 10;
  bullets.push({
    x: player.x,
    y: player.y,
    dx: Math.cos(angle) * speed,
    dy: Math.sin(angle) * speed,
    radius: 5
  });
});

function updateTrophyCount() {
  trophyCountElement.textContent = `Troféus: ${trophyCount}`;
}

function updateLeague() {
  let league;
  if (trophyCount < 400) league = 'Sem Liga';
  else if (trophyCount < 900) league = 'Liga Paia';
  else if (trophyCount < 1200) league = 'Rebelde';
  else if (trophyCount < 1700) league = 'Candidato';
  else if (trophyCount < 2000) league = 'Patrão';
  else if (trophyCount < 2600) league = 'Soberana';
  else if (trophyCount < 3000) league = 'Estrelar';
  else if (trophyCount < 3300) league = 'Liga Maior Campeão';
  else league = 'Celeste';
  
  leagueInfoElement.textContent = `Liga: ${league}`;
}

function saveGameState() {
  const gameState = {
    trophyCount: trophyCount,
    league: leagueInfoElement.textContent.split(': ')[1]
  };
  localStorage.setItem('quantioGameState', JSON.stringify(gameState));
}

function loadGameState() {
  const savedState = localStorage.getItem('quantioGameState');
  if (savedState) {
    const gameState = JSON.parse(savedState);
    trophyCount = gameState.trophyCount;
    updateTrophyCount();
    updateLeague();
  }
}

window.addEventListener('load', loadGameState);

document.getElementById('startGame').addEventListener('click', () => {
  lobby.style.display = 'none';
  canvas.style.display = 'block';
  document.getElementById('healthBar').style.display = 'block';
  resetGame();
  gameInProgress = true;
  gameStartTime = Date.now();
  startSpawning();
  gameLoop();
  startGame();
});

document.getElementById('showEvents').addEventListener('click', () => {
  alert('Eventos em breve!');
});

document.getElementById('showShop').addEventListener('click', () => {
  alert('Loja em breve!');
});

returnToLobbyButton.addEventListener('click', () => {
  gameOverScreen.style.display = 'none';
  lobby.style.display = 'flex';
});

updateTrophyCount();
updateLeague();
</script>
</body>
</html>