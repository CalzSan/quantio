<html><head><base href="https://enhanced-survival-shooter-v3.example.com/">
<meta charset="UTF-8">
<title>Quantio by Calzsan: Jogo de Sobrevivência</title>
<style>
  body, html {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    background-color: #111;
    font-family: Arial, sans-serif;
    color: #fff;
  }
  #loadingScreen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: #1a1a2e;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 9999;
  }
  .loader {
    border: 5px solid #f3f3f3;
    border-top: 5px solid #16213e;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    animation: spin 1s linear infinite;
  }
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  #nameInputScreen {
    background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px;
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
    border-radius: 15px;
    max-width: 400px;
    margin: 50px auto;
  }
  #playerNameInput {
    margin: 20px 0;
    padding: 10px;
    font-size: 18px;
    width: 100%;
    max-width: 300px;
  }
  #submitName {
    font-size: 18px;
    padding: 10px 20px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }
  #lobby {
    background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px;
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
    border-radius: 15px;
    max-width: 800px;
    margin: 50px auto;
  }
  .game-title {
    font-size: 48px;
    font-weight: bold;
    color: #fff;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    margin-bottom: 20px;
  }
  .game-subtitle {
    font-size: 24px;
    color: #ddd;
    margin-bottom: 40px;
  }
  #playerNameDisplay {
    font-size: 18px;
    color: #fff;
    margin-bottom: 20px;
  }
  .stats-container {
    display: flex;
    justify-content: space-around;
    width: 100%;
    margin-bottom: 40px;
  }
  .stat-item {
    background-color: rgba(255, 255, 255, 0.1);
    padding: 15px 25px;
    border-radius: 10px;
    text-align: center;
    transition: transform 0.3s ease;
  }
  .stat-item:hover {
    transform: translateY(-5px);
  }
  .stat-value {
    font-size: 24px;
    font-weight: bold;
    color: #fff;
  }
  .stat-label {
    font-size: 14px;
    color: #ddd;
  }
  .menu-container {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
    width: 100%;
  }
  .menu-item {
    font-size: 18px;
    padding: 15px 30px;
    background: linear-gradient(45deg, #ff6b6b, #feca57);
    border: none;
    border-radius: 25px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
    color: #fff;
    text-transform: uppercase;
    font-weight: bold;
    letter-spacing: 1px;
  }
  .menu-item:hover {
    transform: scale(1.05);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
  }
  #gameCanvas {
    width: 100%;
    height: 100%;
    display: none;
  }
  #healthBar {
    position: absolute;
    top: 10px;
    left: 10px;
    width: 200px;
    height: 20px;
    background-color: #333;
    border: 2px solid #fff;
    display: none;
  }
  #healthFill {
    width: 100%;
    height: 100%;
    background-color: #0f0;
    transition: width 0.3s;
  }
  #timerDisplay {
    position: absolute;
    top: 10px;
    right: 10px;
    font-size: 24px;
    display: none;
  }
  #gameOverScreen {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 10;
  }
  #gameOverMessage {
    font-size: 48px;
    margin-bottom: 20px;
  }
  #trophyChange {
    font-size: 24px;
    margin-bottom: 20px;
  }
  #returnToLobby {
    font-size: 24px;
    padding: 10px 20px;
    background-color: #444;
    border-radius: 5px;
    cursor: pointer;
  }
  #leaguesScreen {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 10;
  }
  #leaguesList {
    list-style-type: none;
    padding: 0;
    margin: 20px 0;
  }
  #leaguesList li {
    font-size: 18px;
    margin: 10px 0;
  }
  #shopScreen {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 10;
  }
  .shop-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    max-width: 800px;
    margin: 0 auto;
  }
  #moneyDisplay {
    font-size: 24px;
    margin-bottom: 20px;
  }
  .shop-item {
    background: linear-gradient(135deg, #3494e6, #ec6ead);
    border-radius: 10px;
    padding: 15px;
    text-align: center;
    transition: transform 0.3s ease, box-shadow 0.3s ease, opacity 0.3s ease;
  }
  .shop-item:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
  }
  .shop-item-name {
    font-size: 18px;
    font-weight: bold;
    margin-bottom: 10px;
  }
  .shop-item-cost {
    font-size: 16px;
  }
  #eventScreen {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 10;
  }
  #exportImportScreen {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 10;
  }
  #exportImportCode {
    margin: 20px 0;
    padding: 10px;
    font-size: 16px;
    width: 80%;
    max-width: 600px;
  }
  #exportMoneyButton, #exportAccountButton, #importButton {
    font-size: 18px;
    padding: 10px 20px;
    margin: 10px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }
  #statisticsScreen {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 10;
  }
</style>
</head>
<body>
<div id="loadingScreen">
  <div class="loader"></div>
  <p>Carregando Quantio...</p>
</div>
<div id="nameInputScreen" style="display: none;">
  <h2>Bem-vindo ao Quantio!</h2>
  <p>Por favor, insira seu nome:</p>
  <input type="text" id="playerNameInput" maxlength="20">
  <button id="submitName">Confirmar</button>
</div>
<div id="lobby">
  <h1 class="game-title">Quantio</h1>
  <h2 class="game-subtitle">by Calzsan</h2>
  <div id="playerNameDisplay"></div>
  <div class="stats-container">
    <div class="stat-item">
      <div class="stat-value" id="trophyCount">0</div>
      <div class="stat-label">Troféus</div>
    </div>
    <div class="stat-item">
      <div class="stat-value" id="leagueInfo">Sem Liga</div>
      <div class="stat-label">Liga</div>
    </div>
    <div class="stat-item">
      <div class="stat-value" id="moneyCount">0</div>
      <div class="stat-label">Moedas</div>
    </div>
  </div>
  <div class="menu-container">
    <button class="menu-item" id="startGame">Iniciar Jogo</button>
    <button class="menu-item" id="showEvents" disabled="" style="opacity: 0.5; cursor: not-allowed;">Em manutenção por Calzsan</button>
    <button class="menu-item" id="showShop">Loja</button>
    <button class="menu-item" id="showLeagues">Ligas</button>
    <button class="menu-item" id="showStatistics">Estatísticas</button>
    <button class="menu-item" id="showExportImport">Exportar/Importar</button>
  </div>
</div>
<div id="leaguesScreen" style="display: none;">
  <h2>Ligas e Troféus</h2>
  <ul id="leaguesList"></ul>
  <div class="menu-item" id="returnFromLeagues">Voltar ao Lobby</div>
</div>
<div id="shopScreen" style="display: none;">
  <h2>Loja</h2>
  <div id="moneyDisplay"></div>
  <div id="shopItems" class="shop-grid"></div>
  <div class="menu-item" id="returnFromShop">Voltar ao Lobby</div>
</div>
<div id="eventScreen" style="display: none;">
  <h2>Evento Especial</h2>
  <p>Sobreviva por 60 segundos em cada partida! Complete 9 vitórias antes de 3 derrotas para ganhar o torneio. Prêmio: 1500 moedas e um distintivo exclusivo de campeão do evento!</p>
  <p>Vitórias: <span id="eventWins">0</span>/9</p>
  <p>Derrotas: <span id="eventLosses">0</span>/3</p>
  <div class="menu-item" id="startEvent">Iniciar Evento</div>
  <div class="menu-item" id="returnFromEvent">Voltar ao Lobby</div>
</div>
<div id="exportImportScreen" style="display: none;">
  <h2>Exportar/Importar Dados</h2>
  <div>
    <input type="text" id="moneyExportCode" placeholder="Código para exportar moedas">
    <button id="exportMoneyButton">Exportar Moedas</button>
  </div>
  <div>
    <input type="text" id="accountExportCode" placeholder="Código para exportar conta">
    <button id="exportAccountButton">Exportar Conta Completa</button>
  </div>
  <textarea id="exportImportCode" rows="5" cols="50" placeholder="Cole o código aqui para importar"></textarea>
  <button id="importButton">Importar Dados</button>
  <div class="menu-item" id="returnFromExportImport">Voltar ao Lobby</div>
</div>
<div id="statisticsScreen" style="display: none;">
  <h2>Estatísticas</h2>
  <ul id="statisticsList"></ul>
  <div class="menu-item" id="returnFromStatistics">Voltar ao Lobby</div>
</div>
<canvas id="gameCanvas"></canvas>
<div id="healthBar"><div id="healthFill"></div></div>
<div id="timerDisplay"></div>
<div id="gameOverScreen">
  <div id="gameOverMessage"></div>
  <div id="trophyChange"></div>
  <div id="returnToLobby">Voltar ao Lobby</div>
</div>
<script>
let lastExportedCode = '';
let importedCodes = new Set();
let playerName = '';
let maxTrophies = 0;
let totalVictories = 0;
let totalDefeats = 0;
let maxGoldEarned = 0;
let totalGoldSpent = 0;
let totalAbilitiesUsed = 0;

function showNameInputScreen() {
  document.getElementById('nameInputScreen').style.display = 'flex';
  document.getElementById('lobby').style.display = 'none';
}

function hideNameInputScreen() {
  document.getElementById('nameInputScreen').style.display = 'none';
  document.getElementById('lobby').style.display = 'flex';
}

function setPlayerName() {
  const nameInput = document.getElementById('playerNameInput');
  playerName = nameInput.value.trim();
  if (playerName) {
    localStorage.setItem('quantioPlayerName', playerName);
    hideNameInputScreen();
    updatePlayerNameDisplay();
  } else {
    alert('Por favor, insira um nome válido.');
  }
}

function updatePlayerNameDisplay() {
  const nameDisplay = document.getElementById('playerNameDisplay');
  if (nameDisplay) {
    nameDisplay.textContent = playerName ? `Jogador: ${playerName}` : 'Jogador: Sem nome';
  }
}

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const healthFill = document.getElementById('healthFill');
const lobby = document.getElementById('lobby');
const gameOverScreen = document.getElementById('gameOverScreen');
const gameOverMessage = document.getElementById('gameOverMessage');
const trophyChangeElement = document.getElementById('trophyChange');
const returnToLobbyButton = document.getElementById('returnToLobby');
const trophyCountElement = document.getElementById('trophyCount');
const leagueInfoElement = document.getElementById('leagueInfo');
const moneyCountElement = document.getElementById('moneyCount');
const timerDisplay = document.getElementById('timerDisplay');

let trophyCount = 0;
let money = 0;
let gameStartTime;
let gameInProgress = false;
let gameTimer;
let gameTimerInterval;
let playerLevel = 1;

let activePowerUps = {
  doubleProjectiles: false,
  damageReduction: 1,
  repulsion: false,
  speedBoost: false,
  explosiveShot: false,
  temporaryShield: false,
  regeneration: false,
  freezeShot: false
};

let doubleProjectiles = false;
let damageReduction = 1;

let eventWins = 0;
let eventLosses = 0;
let eventEliminated = false;
let inEvent = false;

const shopItems = [
  { name: 'Tiros 2x', cost: 200, effect: () => activePowerUps.doubleProjectiles = true },
  { name: 'Redução de Dano 2x', cost: 300, effect: () => activePowerUps.damageReduction = 0.5 },
  { name: 'Repulsão', cost: 300, maintenance: true },
  { name: 'Velocidade +50%', cost: 250, maintenance: true },
  { name: 'Tiro Explosivo', cost: 400, maintenance: true },
  { name: 'Escudo Temporário', cost: 350, maintenance: true },
  { name: 'Regeneração', cost: 300, maintenance: true },
  { name: 'Tiro Congelante', cost: 350, maintenance: true }
];

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const player = {
  x: canvas.width / 2,
  y: canvas.height / 2,
  radius: 20,
  speed: 5,
  color: '#00ff00',
  dx: 0,
  dy: 0,
  health: 100,
  isStuck: false,
  stuckTime: 0
};

const bullets = [];
const enemyBullets = [];
const enemies = [];
let mouseX = 0;
let mouseY = 0;
let spawnInterval;

const monsterTypes = ['normal', 'zombie', 'fast', 'squad'];

function spawnEnemy() {
  const side = Math.floor(Math.random() * 4);
  let x, y;

  switch(side) {
    case 0: x = Math.random() * canvas.width; y = -30; break;
    case 1: x = canvas.width + 30; y = Math.random() * canvas.height; break;
    case 2: x = Math.random() * canvas.width; y = canvas.height + 30; break;
    case 3: x = -30; y = Math.random() * canvas.height; break;
  }

  const type = monsterTypes[Math.floor(Math.random() * monsterTypes.length)];
  let enemy = {
    x: x,
    y: y,
    radius: 15,
    speed: 2,
    color: '#ff0000',
    angle: Math.random() * Math.PI * 2,
    detectionRadius: 200,
    evadeSpeed: 3,
    lastShot: 0,
    wanderAngle: Math.random() * Math.PI * 2,
    type: type
  };

  switch(type) {
    case 'zombie':
      enemy.color = '#00ff00';
      enemy.speed = 1.5;
      break;
    case 'fast':
      enemy.color = '#ffff00';
      enemy.speed = 4;
      enemy.radius = 10;
      break;
    case 'squad':
      enemy.color = '#ff00ff';
      enemy.members = [
        {shots: 1},
        {shots: 2},
        {shots: 3},
        {shots: 4}
      ];
      break;
  }

  enemies.push(enemy);
}

function drawPlayer() {
  ctx.save();
  ctx.translate(player.x, player.y);
  ctx.rotate(Math.atan2(mouseY - player.y, mouseX - player.x));

  ctx.beginPath();
  ctx.arc(0, 0, player.radius, 0, Math.PI * 2);
  ctx.fillStyle = player.isStuck ? '#808080' : '#4a90e2';
  ctx.fill();

  ctx.beginPath();
  ctx.arc(0, 0, player.radius * 0.8, 0, Math.PI * 2);
  ctx.strokeStyle = '#2c3e50';
  ctx.lineWidth = 3;
  ctx.stroke();

  ctx.fillStyle = '#ffffff';
  ctx.beginPath();
  ctx.arc(player.radius * 0.3, -player.radius * 0.2, player.radius * 0.2, 0, Math.PI * 2);
  ctx.arc(player.radius * 0.3, player.radius * 0.2, player.radius * 0.2, 0, Math.PI * 2);
  ctx.fill();

  ctx.fillStyle = '#333333';
  ctx.fillRect(player.radius * 0.5, -player.radius * 0.1, player.radius * 0.8, player.radius * 0.2);

  ctx.restore();
}

function drawEnemies() {
  enemies.forEach(enemy => {
    ctx.save();
    ctx.translate(enemy.x, enemy.y);
    ctx.rotate(enemy.angle);
    
    switch(enemy.type) {
      case 'normal':
        drawNormalEnemy(enemy);
        break;
      case 'zombie':
        drawZombieEnemy(enemy);
        break;
      case 'fast':
        drawFastEnemy(enemy);
        break;
      case 'squad':
        drawSquadEnemy(enemy);
        break;
    }

    ctx.restore();
  });
}

function drawNormalEnemy(enemy) {
  ctx.fillStyle = '#ff4136';
  ctx.beginPath();
  ctx.arc(0, 0, enemy.radius, 0, Math.PI * 2);
  ctx.fill();

  ctx.fillStyle = '#ffffff';
  ctx.beginPath();
  ctx.arc(enemy.radius * 0.3, -enemy.radius * 0.2, enemy.radius * 0.2, 0, Math.PI * 2);
  ctx.arc(enemy.radius * 0.3, enemy.radius * 0.2, enemy.radius * 0.2, 0, Math.PI * 2);
  ctx.fill();

  ctx.strokeStyle = '#990000';
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.moveTo(-enemy.radius * 0.5, -enemy.radius * 0.5);
  ctx.lineTo(enemy.radius * 0.5, enemy.radius * 0.5);
  ctx.moveTo(enemy.radius * 0.5, -enemy.radius * 0.5);
  ctx.lineTo(-enemy.radius * 0.5, enemy.radius * 0.5);
  ctx.stroke();
}

function drawZombieEnemy(enemy) {
  ctx.fillStyle = '#2ecc40';
  ctx.beginPath();
  ctx.arc(0, 0, enemy.radius, 0, Math.PI * 2);
  ctx.fill();

  ctx.fillStyle = '#ff4136';
  ctx.beginPath();
  ctx.arc(enemy.radius * 0.3, -enemy.radius * 0.2, enemy.radius * 0.2, 0, Math.PI * 2);
  ctx.arc(enemy.radius * 0.3, enemy.radius * 0.2, enemy.radius * 0.2, 0, Math.PI * 2);
  ctx.fill();

  ctx.strokeStyle = '#1a8829';
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.arc(0, enemy.radius * 0.3, enemy.radius * 0.4, 0, Math.PI);
  ctx.stroke();
}

function drawFastEnemy(enemy) {
  ctx.fillStyle = '#ffdc00';
  ctx.beginPath();
  ctx.moveTo(enemy.radius, 0);
  ctx.lineTo(-enemy.radius, -enemy.radius);
  ctx.lineTo(-enemy.radius, enemy.radius);
  ctx.closePath();
  ctx.fill();

  ctx.fillStyle = '#ffffff';
  ctx.beginPath();
  ctx.arc(enemy.radius * 0.2, 0, enemy.radius * 0.2, 0, Math.PI * 2);
  ctx.fill();

  ctx.strokeStyle = '#ff851b';
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.moveTo(-enemy.radius * 1.2, 0);
  ctx.lineTo(-enemy.radius * 1.6, 0);
  ctx.moveTo(-enemy.radius * 1.3, -enemy.radius * 0.3);
  ctx.lineTo(-enemy.radius * 1.7, -enemy.radius * 0.4);
  ctx.moveTo(-enemy.radius * 1.3, enemy.radius * 0.3);
  ctx.lineTo(-enemy.radius * 1.7, enemy.radius * 0.4);
  ctx.stroke();
}

function drawSquadEnemy(enemy) {
  ctx.fillStyle = '#b10dc9';
  ctx.beginPath();
  ctx.arc(0, 0, enemy.radius, 0, Math.PI * 2);
  ctx.fill();

  const positions = [
    {x: -enemy.radius * 0.6, y: -enemy.radius * 0.6},
    {x: enemy.radius * 0.6, y: -enemy.radius * 0.6},
    {x: -enemy.radius * 0.6, y: enemy.radius * 0.6},
    {x: enemy.radius * 0.6, y: enemy.radius * 0.6}
  ];

  ctx.fillStyle = '#ffffff';
  positions.forEach((pos, index) => {
    ctx.beginPath();
    ctx.arc(pos.x, pos.y, enemy.radius * 0.3, 0, Math.PI * 2);
    ctx.fill();
    
    ctx.fillStyle = '#000000';
    ctx.font = `${enemy.radius * 0.3}px Arial`;
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(index + 1, pos.x, pos.y);
  });

  ctx.strokeStyle = '#7b0c8e';
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.moveTo(-enemy.radius * 0.6, -enemy.radius * 0.6);
  ctx.lineTo(enemy.radius * 0.6, enemy.radius * 0.6);
  ctx.moveTo(enemy.radius * 0.6, -enemy.radius * 0.6);
  ctx.lineTo(-enemy.radius * 0.6, enemy.radius * 0.6);
  ctx.stroke();
}

function moveEnemies() {
  enemies.forEach(enemy => {
    let dx = player.x - enemy.x;
    let dy = player.y - enemy.y;
    let distance = Math.sqrt(dx * dx + dy * dy);

    let moveX, moveY;

    if (enemy.type === 'fast') {
      if (activePowerUps.repulsion && distance < 100) {
        moveX = -dx / distance;
        moveY = -dy / distance;
      } else {
        moveX = dx / distance;
        moveY = dy / distance;
      }
    } else {
      if (distance < 200 || (activePowerUps.repulsion && distance < 100)) {
        moveX = -dx / distance;
        moveY = -dy / distance;
      } else {
        enemy.wanderAngle += (Math.random() - 0.5) * 0.5;
        moveX = Math.cos(enemy.wanderAngle);
        moveY = Math.sin(enemy.wanderAngle);
      }
    }

    enemy.x += moveX * enemy.speed;
    enemy.y += moveY * enemy.speed;

    enemy.angle = Math.atan2(moveY, moveX);

    enemy.x = Math.max(enemy.radius, Math.min(canvas.width - enemy.radius, enemy.x));
    enemy.y = Math.max(enemy.radius, Math.min(canvas.height - enemy.radius, enemy.y));

    if (Date.now() - enemy.lastShot > 1000 && distance < 300) {
      const angle = Math.atan2(player.y - enemy.y, player.x - enemy.x);
      const speed = 3;

      if (enemy.type === 'normal' || enemy.type === 'zombie') {
        enemyBullets.push({
          x: enemy.x,
          y: enemy.y,
          dx: Math.cos(angle) * speed,
          dy: Math.sin(angle) * speed,
          radius: 3,
          color: enemy.type === 'zombie' ? '#00ff00' : '#ff8800'
        });
      } else if (enemy.type === 'squad') {
        enemy.members.forEach(member => {
          for (let i = 0; i < member.shots; i++) {
            const spreadAngle = angle + (Math.random() - 0.5) * 0.5;
            enemyBullets.push({
              x: enemy.x,
              y: enemy.y,
              dx: Math.cos(spreadAngle) * speed,
              dy: Math.sin(spreadAngle) * speed,
              radius: 3,
              color: '#ff00ff'
            });
          }
        });
      }

      enemy.lastShot = Date.now();
    }

    if (enemy.type === 'fast' && distance < enemy.radius + player.radius) {
      if (!activePowerUps.temporaryShield) {
        player.health -= 2 * activePowerUps.damageReduction;
        updateHealthBar();
        if (player.health <= 0) {
          gameOver(false);
        }
      }
    }
  });
}

function movePlayer() {
  if (!player.isStuck) {
    const speedMultiplier = activePowerUps.speedBoost ? 1.5 : 1;
    player.x += player.dx * speedMultiplier;
    player.y += player.dy * speedMultiplier;
    player.x = Math.max(player.radius, Math.min(canvas.width - player.radius, player.x));
    player.y = Math.max(player.radius, Math.min(canvas.height - player.radius, player.y));
  } else {
    player.stuckTime--;
    if (player.stuckTime <= 0) {
      player.isStuck = false;
    }
  }

  if (activePowerUps.regeneration && player.health < 100) {
    player.health = Math.min(100, player.health + 0.1);
    updateHealthBar();
  }
}

function drawBullets() {
  bullets.forEach(bullet => {
    ctx.beginPath();
    ctx.arc(bullet.x, bullet.y, 5, 0, Math.PI * 2);
    ctx.fillStyle = '#ffff00';
    ctx.fill();
    ctx.closePath();
  });

  enemyBullets.forEach(bullet => {
    ctx.beginPath();
    ctx.arc(bullet.x, bullet.y, 3, 0, Math.PI * 2);
    ctx.fillStyle = bullet.color || '#ff8800';
    ctx.fill();
    ctx.closePath();
  });
}

function drawCrosshair() {
  ctx.beginPath();
  ctx.arc(mouseX, mouseY, 10, 0, Math.PI * 2);
  ctx.strokeStyle = '#ff0000';
  ctx.lineWidth = 2;
  ctx.stroke();
  ctx.closePath();

  ctx.beginPath();
  ctx.moveTo(mouseX - 15, mouseY);
  ctx.lineTo(mouseX + 15, mouseY);
  ctx.moveTo(mouseX, mouseY - 15);
  ctx.lineTo(mouseX, mouseY + 15);
  ctx.strokeStyle = '#ff0000';
  ctx.lineWidth = 2;
  ctx.stroke();
  ctx.closePath();
}

function moveBullets() {
  bullets.forEach((bullet, index) => {
    bullet.x += bullet.dx;
    bullet.y += bullet.dy;
    if (bullet.x < 0 || bullet.x > canvas.width || bullet.y < 0 || bullet.y > canvas.height) {
      bullets.splice(index, 1);
    }
  });

  enemyBullets.forEach((bullet, index) => {
    bullet.x += bullet.dx;
    bullet.y += bullet.dy;
    if (bullet.x < 0 || bullet.x > canvas.width || bullet.y < 0 || bullet.y > canvas.height) {
      enemyBullets.splice(index, 1);
    }
  });
}

function checkCollisions() {
  bullets.forEach((bullet, bIndex) => {
    enemies.forEach((enemy, eIndex) => {
      const dx = bullet.x - enemy.x;
      const dy = bullet.y - enemy.y;
      const distance = Math.sqrt(dx * dx + dy * dy);

      if (distance < bullet.radius + enemy.radius) {
        bullets.splice(bIndex, 1);
        
        if (bullet.type === 'explosive') {
          enemies.forEach((nearbyEnemy, nearbyIndex) => {
            const nearbyDx = nearbyEnemy.x - enemy.x;
            const nearbyDy = nearbyEnemy.y - enemy.y;
            const nearbyDistance = Math.sqrt(nearbyDx * nearbyDx + nearbyDy * nearbyDy);
            if (nearbyDistance < 100) {
              enemies.splice(nearbyIndex, 1);
            }
          });
        } else if (bullet.type === 'freeze') {
          enemy.speed *= 0.5;
          enemy.color = '#00ffff';
          setTimeout(() => {
            enemy.speed *= 2;
            enemy.color = enemy.originalColor;
          }, 3000);
        }
        
        enemies.splice(eIndex, 1);
      }
    });
  });

  enemyBullets.forEach((bullet, bIndex) => {
    const dx = bullet.x - player.x;
    const dy = bullet.y - player.y;
    const distance = Math.sqrt(dx * dx + dy * dy);

    if (distance < bullet.radius + player.radius) {
      enemyBullets.splice(bIndex, 1);
      if (bullet.color === '#00ff00') {
        player.isStuck = true;
        player.stuckTime = 5 * 60;
      } else {
        player.health -= 10 * damageReduction;
        updateHealthBar();
        if (player.health <= 0) {
          gameOver(false);
        }
      }
    }
  });
}

function updateHealthBar() {
  healthFill.style.width = `${player.health}%`;
}

function updateMoneyCount() {
  moneyCountElement.textContent = `Moedas: ${money}`;
}

function gameOver(won) {
  clearInterval(gameTimerInterval);
  saveGameState();
  gameInProgress = false;
  clearInterval(spawnInterval);
  timerDisplay.style.display = 'none';
  const gameTime = (Date.now() - gameStartTime) / 1000;
  
  let trophyChange = 0;
  if (won) {
    totalVictories++;
    const moneyEarned = Math.floor(player.health);
    maxGoldEarned = Math.max(maxGoldEarned, moneyEarned);
    trophyChange = Math.floor(Math.random() * 6) + 28;
    trophyCount += trophyChange;
    money += moneyEarned;
    gameOverMessage.textContent = `Vitória! Você sobreviveu por ${gameTime.toFixed(1)} segundos!`;
    trophyChangeElement.textContent = `Troféus +${trophyChange} | Moedas +${moneyEarned}`;
    
    if (inEvent) {
      eventWins++;
      if (eventWins === 9) {
        money += 1500;
        alert('Parabéns! Você completou o evento e ganhou 1500 moedas!');
        resetEventStatus();
      }
    }
  } else {
    totalDefeats++;
    trophyChange = -(Math.floor(Math.random() * 4) + 24);
    trophyCount = Math.max(0, trophyCount + trophyChange);
    gameOverMessage.textContent = `Derrota! Você sobreviveu por ${gameTime.toFixed(1)} segundos.`;
    trophyChangeElement.textContent = `Troféus ${trophyChange}`;
    
    if (inEvent) {
      eventLosses++;
      if (eventLosses === 3) {
        alert('Você foi eliminado do evento!');
        eventEliminated = true;
        resetEventStatus();
      }
    }
  }

  maxTrophies = Math.max(maxTrophies, trophyCount);
  updateTrophyCount();
  updateLeague();
  updateMoneyCount();
  canvas.style.display = 'none';
  document.getElementById('healthBar').style.display = 'none';
  gameOverScreen.style.display = 'flex';
  
  if (inEvent) {
    updateEventScreen();
  }

  doubleProjectiles = false;
  damageReduction = 1;
  
  saveGameState();

  setTimeout(() => {
    location.reload();
  }, 3000);
}

function resetEventStatus() {
  eventWins = 0;
  eventLosses = 0;
  eventEliminated = false;
  saveGameState();
}

function resetGame() {
  player.health = 100;
  player.isStuck = false;
  player.stuckTime = 0;
  updateHealthBar();
  enemies.length = 0;
  bullets.length = 0;
  enemyBullets.length = 0;
  player.x = canvas.width / 2;
  player.y = canvas.height / 2;
}

function startSpawning() {
  spawnInterval = setInterval(spawnEnemy, 2000);
}

function gameLoop() {
  if (!gameInProgress) return;

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  movePlayer();
  moveEnemies();
  moveBullets();
  checkCollisions();

  drawPlayer();
  drawEnemies();
  drawBullets();
  drawCrosshair();

  requestAnimationFrame(gameLoop);
}

function startGame(isEvent = false) {
  inEvent = isEvent;
  timerDisplay.style.display = 'block';
  gameTimer = 60;
  updateTimer();
  gameTimerInterval = setInterval(updateTimer, 1000);
  
  lobby.style.display = 'none';
  canvas.style.display = 'block';
  document.getElementById('healthBar').style.display = 'block';
  resetGame();

  doubleProjectiles = activePowerUps.doubleProjectiles;
  damageReduction = activePowerUps.damageReduction;

  activePowerUps = {
    doubleProjectiles: false,
    damageReduction: 1,
    repulsion: false,
    speedBoost: false,
    explosiveShot: false,
    temporaryShield: false,
    regeneration: false,
    freezeShot: false
  };

  gameInProgress = true;
  gameStartTime = Date.now();
  startSpawning();
  gameLoop();
}

function updateTimer() {
  timerDisplay.textContent = `Tempo: ${gameTimer}s`;
  if (gameTimer > 0) {
    gameTimer--;
  } else {
    clearInterval(gameTimerInterval);
    gameOver(true);
  }
}

const leaguesScreen = document.getElementById('leaguesScreen');
const leaguesList = document.getElementById('leaguesList');
const showLeaguesButton = document.getElementById('showLeagues');
const returnFromLeaguesButton = document.getElementById('returnFromLeagues');

const leaguesInfo = [
  { name: 'Sem Liga', trophies: 0 },
  { name: 'Liga Paia', trophies: 400 },
  { name: 'Rebelde', trophies: 900 },
  { name: 'Candidato', trophies: 1200 },
  { name: 'Patrão', trophies: 1700 },
  { name: 'Soberana', trophies: 2000 },
  { name: 'Estrelar', trophies: 2600 },
  { name: 'Liga Maior Campeão', trophies: 3000 },
  { name: 'Celeste', trophies: 3300 }
];

function showLeaguesScreen() {
  leaguesList.innerHTML = '';
  leaguesInfo.forEach(league => {
    const li = document.createElement('li');
    li.textContent = `${league.name}: ${league.trophies} troféus`;
    leaguesList.appendChild(li);
  });
  lobby.style.display = 'none';
  leaguesScreen.style.display = 'flex';
}

function showShopScreen() {
  lobby.style.display = 'none';
  document.getElementById('shopScreen').style.display = 'flex';
  updateShopItems();
}

function updateShopItems() {
  const shopItemsContainer = document.getElementById('shopItems');
  const moneyDisplay = document.getElementById('moneyDisplay');
  shopItemsContainer.innerHTML = '';
  moneyDisplay.textContent = `Suas moedas: ${money}`;
  
  shopItems.forEach(item => {
    const itemElement = document.createElement('div');
    itemElement.className = 'shop-item';
    if (item.maintenance) {
      itemElement.innerHTML = `
        <div class="shop-item-name">${item.name}</div>
        <div class="shop-item-cost">Em manutenção</div>
      `;
      itemElement.style.opacity = '0.5';
      itemElement.style.cursor = 'not-allowed';
    } else {
      itemElement.innerHTML = `
        <div class="shop-item-name">${item.name}</div>
        <div class="shop-item-cost">${item.cost} moedas</div>
      `;
      itemElement.addEventListener('click', () => buyItem(item));
    }
    shopItemsContainer.appendChild(itemElement);
  });
}

function buyItem(item) {
  if (item.maintenance) {
    alert('Este item está em manutenção e não pode ser comprado no momento.');
    return;
  }
  if (money >= item.cost) {
    money -= item.cost;
    totalGoldSpent += item.cost;
    item.effect();
    totalAbilitiesUsed++;
    updateMoneyCount();
    alert(`Você comprou ${item.name}! Será ativo na próxima partida.`);
  } else {
    alert('Moedas insuficientes!');
  }
}

function showEventScreen() {
  if (eventEliminated) {
    alert('Você já foi eliminado deste evento.');
    return;
  }
  lobby.style.display = 'none';
  document.getElementById('eventScreen').style.display = 'flex';
  updateEventScreen();
}

function updateEventScreen() {
  document.getElementById('eventWins').textContent = eventWins;
  document.getElementById('eventLosses').textContent = eventLosses;
}

function showExportImportScreen() {
  lobby.style.display = 'none';
  document.getElementById('exportImportScreen').style.display = 'flex';
}

function exportMoney() {
  const amount = prompt("Digite a quantidade de moedas que deseja exportar:", money);
  if (amount === null) return; 
  
  const parsedAmount = parseInt(amount);
  if (isNaN(parsedAmount) || parsedAmount <= 0 || parsedAmount > money) {
    alert("Quantidade inválida. Por favor, insira um número válido entre 1 e " + money);
    return;
  }

  const customCode = document.getElementById('moneyExportCode').value.trim();
  if (!customCode) {
    alert("Por favor, insira um código personalizado para exportar as moedas.");
    return;
  }

  const moneyData = {
    type: 'money',
    money: parsedAmount,
    timestamp: Date.now()
  };
  const exportCode = customCode + '|' + btoa(JSON.stringify(moneyData));
  
  if (!importedCodes.has(exportCode)) {
    document.getElementById('exportImportCode').value = exportCode;
    
    money -= parsedAmount;
    updateMoneyCount();
    saveGameState();
    
    importedCodes.add(exportCode);
    alert(`${parsedAmount} moedas exportadas! Copie o código para usar em outro dispositivo.`);
  } else {
    alert("Este código já foi usado. Por favor, escolha um código diferente.");
  }
}

function exportAccount() {
  const customCode = document.getElementById('accountExportCode').value.trim();
  if (!customCode) {
    alert("Por favor, insira um código personalizado para exportar a conta.");
    return;
  }

  const accountData = {
    type: 'account',
    trophyCount: trophyCount,
    league: leagueInfoElement.textContent.split(': ')[1],
    playerLevel: playerLevel,
    money: money,
    activePowerUps: activePowerUps,
    playerName: playerName,
    maxTrophies: maxTrophies,
    totalVictories: totalVictories,
    totalDefeats: totalDefeats,
    maxGoldEarned: maxGoldEarned,
    totalGoldSpent: totalGoldSpent,
    totalAbilitiesUsed: totalAbilitiesUsed,
  };
  const exportCode = customCode + '|' + btoa(JSON.stringify(accountData));
  
  if (!importedCodes.has(exportCode)) {
    document.getElementById('exportImportCode').value = exportCode;
    importedCodes.add(exportCode);
    alert('Conta completa exportada! Copie o código para usar em outro dispositivo.');
    
    localStorage.removeItem('quantioGameState');
    localStorage.removeItem('quantioPlayerName');
    
    trophyCount = 0;
    playerLevel = 1;
    money = 0;
    activePowerUps = {
      doubleProjectiles: false,
      damageReduction: 1,
      repulsion: false,
      speedBoost: false,
      explosiveShot: false,
      temporaryShield: false,
      regeneration: false,
      freezeShot: false
    };
    playerName = '';
    
    updateTrophyCount();
    updateLeague();
    updateMoneyCount();
    updatePlayerNameDisplay();
    
    showNameInputScreen();
  } else {
    alert("Este código já foi usado. Por favor, escolha um código diferente.");
  }
}

function importGameData() {
  const importCode = document.getElementById('exportImportCode').value.trim();
  const [customCode, encodedData] = importCode.split('|');
  
  if (!customCode || !encodedData) {
    alert('Código inválido. Por favor, verifique e tente novamente.');
    return;
  }

  try {
    const gameData = JSON.parse(atob(encodedData));
    if (importedCodes.has(importCode)) {
      alert('Este código já foi usado. Por favor, use um novo código.');
      return;
    }

    if (gameData.type === 'money') {
      money += gameData.money;
      updateMoneyCount();
      importedCodes.add(importCode);
      alert(`${gameData.money} moedas importadas com sucesso!`);
    } else if (gameData.type === 'account') {
      trophyCount = gameData.trophyCount;
      playerLevel = gameData.playerLevel;
      money = gameData.money;
      activePowerUps = gameData.activePowerUps;
      playerName = gameData.playerName;
      maxTrophies = gameData.maxTrophies;
      totalVictories = gameData.totalVictories;
      totalDefeats = gameData.totalDefeats;
      maxGoldEarned = gameData.maxGoldEarned;
      totalGoldSpent = gameData.totalGoldSpent;
      totalAbilitiesUsed = gameData.totalAbilitiesUsed;
      
      updateTrophyCount();
      updateLeague();
      updateMoneyCount();
      updatePlayerNameDisplay();
      
      importedCodes.add(importCode);
      alert('Conta completa importada com sucesso!');
      
      saveGameState();
      
      location.reload();
    } else {
      throw new Error('Tipo de dados inválido');
    }
  } catch (error) {
    alert('Código inválido. Por favor, verifique e tente novamente.');
  }
}

function saveGameState() {
  const gameState = {
    trophyCount: trophyCount,
    league: leagueInfoElement.textContent.split(': ')[1],
    playerLevel: playerLevel,
    money: money,
    activePowerUps: activePowerUps,
    importedCodes: Array.from(importedCodes),
    maxTrophies: maxTrophies,
    totalVictories: totalVictories,
    totalDefeats: totalDefeats,
    maxGoldEarned: maxGoldEarned,
    totalGoldSpent: totalGoldSpent,
    totalAbilitiesUsed: totalAbilitiesUsed,
  };
  localStorage.setItem('quantioGameState', JSON.stringify(gameState));
}

function loadGameState() {
  const savedState = localStorage.getItem('quantioGameState');
  if (savedState) {
    const gameState = JSON.parse(savedState);
    trophyCount = gameState.trophyCount;
    playerLevel = gameState.playerLevel || 1;
    money = gameState.money || 0;
    activePowerUps = gameState.activePowerUps || {
      doubleProjectiles: false,
      damageReduction: 1,
      repulsion: false,
      speedBoost: false,
      explosiveShot: false,
      temporaryShield: false,
      regeneration: false,
      freezeShot: false
    };
    importedCodes = new Set(gameState.importedCodes || []);
    maxTrophies = gameState.maxTrophies || 0;
    totalVictories = gameState.totalVictories || 0;
    totalDefeats = gameState.totalDefeats || 0;
    maxGoldEarned = gameState.maxGoldEarned || 0;
    totalGoldSpent = gameState.totalGoldSpent || 0;
    totalAbilitiesUsed = gameState.totalAbilitiesUsed || 0;
    updateTrophyCount();
    updateLeague();
    updateMoneyCount();
  }
  
  playerName = localStorage.getItem('quantioPlayerName');
  if (!playerName) {
    showNameInputScreen();
  } else {
    updatePlayerNameDisplay();
  }
}

function showStatisticsScreen() {
  lobby.style.display = 'none';
  document.getElementById('statisticsScreen').style.display = 'flex';
  updateStatistics();
}

function updateStatistics() {
  const statisticsList = document.getElementById('statisticsList');
  statisticsList.innerHTML = `
    <li>Máximo de troféus alcançados: ${maxTrophies}</li>
    <li>Número de vitórias: ${totalVictories}</li>
    <li>Número de derrotas: ${totalDefeats}</li>
    <li>Máximo de ouro ganho em uma partida: ${maxGoldEarned}</li>
    <li>Total de ouro gasto: ${totalGoldSpent}</li>
    <li>Quantidade de habilidades usadas: ${totalAbilitiesUsed}</li>
  `;
}

showLeaguesButton.addEventListener('click', showLeaguesScreen);

returnFromLeaguesButton.addEventListener('click', () => {
  leaguesScreen.style.display = 'none';
  lobby.style.display = 'flex';
});

returnToLobbyButton.addEventListener('click', () => {
  gameOverScreen.style.display = 'none';
  lobby.style.display = 'flex';
  updateMoneyCount();
});

document.getElementById('submitName').addEventListener('click', setPlayerName);
document.getElementById('showShop').addEventListener('click', showShopScreen);
document.getElementById('returnFromShop').addEventListener('click', () => {
  document.getElementById('shopScreen').style.display = 'none';
  lobby.style.display = 'flex';
});

document.getElementById('showEvents').addEventListener('click', showEventScreen);
document.getElementById('returnFromEvent').addEventListener('click', () => {
  document.getElementById('eventScreen').style.display = 'none';
  lobby.style.display = 'flex';
});

document.getElementById('exportMoneyButton').addEventListener('click', exportMoney);
document.getElementById('exportAccountButton').addEventListener('click', exportAccount);
document.getElementById('importButton').addEventListener('click', importGameData);
document.getElementById('showExportImport').addEventListener('click', showExportImportScreen);
document.getElementById('returnFromExportImport').addEventListener('click', () => {
  document.getElementById('exportImportScreen').style.display = 'none';
  lobby.style.display = 'flex';
});

document.getElementById('showStatistics').addEventListener('click', showStatisticsScreen);
document.getElementById('returnFromStatistics').addEventListener('click', () => {
  document.getElementById('statisticsScreen').style.display = 'none';
  lobby.style.display = 'flex';
});

document.addEventListener('keydown', (e) => {
  if (!player.isStuck) {
    switch(e.key.toLowerCase()) {
      case 'w': player.dy = -player.speed; break;
      case 's': player.dy = player.speed; break;
      case 'a': player.dx = -player.speed; break;
      case 'd': player.dx = player.speed; break;
    }
  }
});

document.addEventListener('keyup', (e) => {
  switch(e.key.toLowerCase()) {
    case 'w':
    case 's': player.dy = 0; break;
    case 'a':
    case 'd': player.dx = 0; break;
  }
});

canvas.addEventListener('mousemove', (e) => {
  mouseX = e.clientX;
  mouseY = e.clientY;
});

canvas.addEventListener('mousedown', (e) => {
  const angle = Math.atan2(e.clientY - player.y, e.clientX - player.x);
  const speed = doubleProjectiles ? 10 : 5;
  const bulletType = activePowerUps.explosiveShot ? 'explosive' : (activePowerUps.freezeShot ? 'freeze' : 'normal');
  
  bullets.push({
    x: player.x,
    y: player.y,
    dx: Math.cos(angle) * speed,
    dy: Math.sin(angle) * speed,
    radius: 5,
    type: bulletType
  });
  
  if (doubleProjectiles) {
    bullets.push({
      x: player.x,
      y: player.y,
      dx: Math.cos(angle + 0.1) * speed,
      dy: Math.sin(angle + 0.1) * speed,
      radius: 5,
      type: bulletType
    });
    bullets.push({
      x: player.x,
      y: player.y,
      dx: Math.cos(angle - 0.1) * speed,
      dy: Math.sin(angle - 0.1) * speed,
      radius: 5,
      type: bulletType
    });
  }
});

function updateTrophyCount() {
  trophyCountElement.textContent = `Troféus: ${trophyCount}`;
}

function updateLeague() {
  let league;
  if (trophyCount < 400) { league = 'Sem Liga'; playerLevel = 1; }
  else if (trophyCount < 900) { league = 'Liga Paia'; playerLevel = 3; }
  else if (trophyCount < 1200) { league = 'Rebelde'; playerLevel = 5; }
  else if (trophyCount < 1700) { league = 'Candidato'; playerLevel = 7; }
  else if (trophyCount < 2000) { league = 'Patrão'; playerLevel = 9; }
  else if (trophyCount < 2600) { league = 'Soberana'; playerLevel = 11; }
  else if (trophyCount < 3000) { league = 'Estrelar'; playerLevel = 13; }
  else if (trophyCount < 3300) { league = 'Liga Maior Campeão'; playerLevel = 15; }
  else { league = 'Celeste'; playerLevel = 17; }
  
  leagueInfoElement.textContent = `Liga: ${league} (Nível ${playerLevel})`;
}

function showStatisticsScreen() {
  lobby.style.display = 'none';
  document.getElementById('statisticsScreen').style.display = 'flex';
  updateStatistics();
}

function updateStatistics() {
  const statisticsList = document.getElementById('statisticsList');
  statisticsList.innerHTML = `
    <li>Máximo de troféus alcançados: ${maxTrophies}</li>
    <li>Número de vitórias: ${totalVictories}</li>
    <li>Número de derrotas: ${totalDefeats}</li>
    <li>Máximo de ouro ganho em uma partida: ${maxGoldEarned}</li>
    <li>Total de ouro gasto: ${totalGoldSpent}</li>
    <li>Quantidade de habilidades usadas: ${totalAbilitiesUsed}</li>
  `;
}

window.addEventListener('load', () => {
  const loadingScreen = document.getElementById('loadingScreen');
  loadingScreen.style.opacity = '1';
  
  setTimeout(() => {
    loadingScreen.style.opacity = '0';
    setTimeout(() => {
      loadingScreen.style.display = 'none';
    }, 500);
  }, 2000);
  
  loadGameState();
  updateMoneyCount();
});

document.getElementById('startGame').addEventListener('click', () => {
  lobby.style.display = 'none';
  canvas.style.display = 'block';
  document.getElementById('healthBar').style.display = 'block';
  resetGame();
  gameInProgress = true;
  gameStartTime = Date.now();
  startSpawning();
  gameLoop();
  startGame();
});

updateTrophyCount();
updateLeague();
</script>
</body></html>